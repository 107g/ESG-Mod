<?xml version="1.0" encoding="utf-8"?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:noNamespaceSchemaLocation="../Schemas/QuestDefinition.xsd">

 
    <!--Unfallen Balanced Start does not currently work due to Guardian being converted into food. To be removed until that is fixed.-->

    <QuestDefinition Name="UnfallenQuest-Chapter00" Category="MajorQuest" SubCategory="Unfallen">      

        <!--============ TAGS ============-->
        
        <Tags>BeginTurn,Hidden</Tags>        

        <!--============ CONTEXT ============-->
        
        <QuestContextSolo/>

        <!--============ OCCURRENCE RULES ============-->
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
           
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            
            <Var VarName="$DefinitionName1" StringValue="BalancedStartUnfallen"/>     
            <Var VarName="$PopulationAffinity" StringValue="AffinityUnfallen"/> 
            <Var VarName="$PopulationAffinity2" StringValue="AffinityGuardians"/> 
            <Var VarName="$PopulationAffinity3" StringValue="AffinityGreenman"/> 
            <Var VarName="$Amount" IntValue="-2"/> 
            <Var VarName="$Amount2" IntValue="-1"/> 
        </Vars>

        <!--============ PREREQUISITES ============-->
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityUnfallen,PopulationMajor</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityGreenman</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityGuardians</PathPrerequisite>
            <GameSettingPrerequisite>BalancedHomes,True</GameSettingPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Objective_Fake">
                        <Sequence>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount2"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity2"/>
                            </Action_SpawnPopulation>  
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount2"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity3"/>
                            </Action_SpawnPopulation>
                            <Action_ApplyStarSystemDefinition>
                                <Input_DefinitionName VarName="$DefinitionName1"/>
                                <Input_StarSystemNode VarName="$HomeSystem"/>
                            </Action_ApplyStarSystemDefinition>        
                            <Action_ChooseOutcome Name="Outcome1"/>                 
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>UnfallenQuest-Chapter01</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
  
  <QuestDefinition Name="UnfallenQuest-Chapter01" Category="MajorQuest" SubCategory="Unfallen">

        <Tags>UnfallenQuest-Chapter01, Hidden</Tags> 

        <QuestContextSolo/>  

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                            NumberOfOccurrencesPerEmpire="1"
                            NumberOfConcurrentInstances="0"/> 

        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
           
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>

            <Var VarName="$HomePlanet">
                <Any>
                    <From Source="$HomeSystem.$Planets">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ClassPlanet,IsUniquePlanet</PathPrerequisite>
                        </Where>
                    </From>
                </Any>
            </Var> 

            <Var VarName="$Amount01" IntValue="2"/> 
            <Var VarName="$Amount02" IntValue="1"/> 
            <Var VarName="$PopulationAffinity" StringValue="AffinityUnfallen"/> 
            <Var VarName="$PopulationAffinity2" StringValue="AffinityGuardians"/> 
            <Var VarName="$PopulationAffinity3" StringValue="AffinityGreenman"/> 
        </Vars>

        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityUnfallen,PopulationMajor</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityGreenman</PathPrerequisite>
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityGuardians</PathPrerequisite>
        </Prerequisites>

        <!--============ STEPS ============-->
        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Objective_Fake">
                        <Sequence>
                            <Action_Colonize>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_Planet VarName="$HomePlanet"/>
                            </Action_Colonize>  
                            <!--<Decorator_EntityCreated>
                                <Input_GUID VarName="$NewHomeGUID"/>
                                <Output_Entity VarName="$NewHome"/>
                            </Decorator_EntityCreated>   -->                     
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount01"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity"/>
                            </Action_SpawnPopulation>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount02"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity2"/>
                            </Action_SpawnPopulation>
                            <Action_SpawnPopulation>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_System VarName="$HomeSystem"/>
                                <Input_Amount VarName="$Amount02"/>
                                <Input_PopulationAffinity VarName="$PopulationAffinity3"/>
                            </Action_SpawnPopulation>            
                        </Sequence>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>

        
    </QuestDefinition>

</Datatable>